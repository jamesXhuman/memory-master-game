"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const core_1 = require("../../../core");
// import { response } from "../../../core";
const constants_1 = require("../../../core/constants");
async function default_1(context, req) {
    const headers = req === null || req === void 0 ? void 0 : req.headers;
    const host = headers ? headers["x-forwarded-host"] || headers.host : undefined;
    if (!host) {
        context.res = (0, core_1.response)({
            context,
            status: 500,
        });
        return;
    }
    const uri = `${headers["x-forwarded-proto"] || constants_1.SWA_CLI_APP_PROTOCOL}://${host}`;
    const query = new URL((req === null || req === void 0 ? void 0 : req.url) || "", uri).searchParams;
    const location = `${uri}${query.get("post_logout_redirect_uri") || "/"}`;
    const cookiesManager = new core_1.CookiesManager(req.headers.cookie);
    cookiesManager.addCookieToDelete("StaticWebAppsAuthCookie");
    context.res = (0, core_1.response)({
        context,
        status: 302,
        cookies: cookiesManager.getCookies(),
        headers: {
            Location: location,
        },
    });
}
exports.default = default_1;
//# sourceMappingURL=auth-logout.js.map